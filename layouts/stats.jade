extend page


block title
  - var title = "Статистика";
  title #{title} • #{site.title}

block meta
  meta(property="description" content=site.description)

  meta(name="og:url"         content=site.site_url + 'stats/')
  meta(name="og:image"       content="https://i.imgur.com/GpzEJQ7.jpg?1")
  meta(name="og:title"       content="#{title} • #{site.title}")
  meta(name="og:description" content=site.description)

block content

  .jumbotron
    .container
      .row
        .col-md-12
          include menu
          .page-header
            h1
              a(href="/") jsunderhood
              small= " / Статистика"
            p.hidden-xs Коллективный твиттер-аккаунт для фронтенд-разработчиков с новым автором каждую неделю
      .row.hidden-xs
        .col-md-12
          include share-text
  style
    | th { cursor: pointer; color: #337AB7; }
    | th nobr {  border-bottom: 1px dotted #77B3DA; }
    | th.no-sort { cursor: default; }
    | th .sort-icon { display: none; }
    | th.sort-up .sort-down { display: inline; }
    | th.sort-down   .sort-up   { display: inline; }

  style.
    .host-stats {
      width: 100%;
      font-size: 15px;
    }

    .host-stats__head {
      width: 100%;
      font-size: 18px;
      border-bottom: 1px solid rgb(140,140,140);
    }

    .host-stats__row:hover {
      background-color: rgba(240,173,78,.1);
    }

    .host-stats__row_head:hover {
      background-color: transparent;
    }

    .host-stats__col {
      padding: 10px;
      vertical-align: middle;
    }

    .host-stats__col_center {
      text-align: center;
    }

    .host-stats__col_right {
      text-align: right;
    }

    .host-stats__col_kpi {
      width: 100px;
    }

    .tweet-graph {
      display: table;
    }

    .tweet-graph__bar {
      padding-left: .5em;
      padding-right: .5em;
      display: table-cell;
      font-size: 13px;
      font-weight: 700;
      letter-spacing: .025em;
      line-height: 1.5;
      text-align: center;
      overflow: hidden;
    }

    .tweet-stats {
      position: relative;
      margin-right: .3em;
      padding-left: .3em;
      padding-right: .3em;
      display: inline-block;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: .05em;
      text-transform: uppercase;
    }

    .tweet-stats_own {
      color: rgb(51,122,183);
      background-color: rgba(51,122,183,.1);
    }

    .tweet-stats_retweets {
      color: rgb(91,192,222);
      background-color: rgba(91,192,222,.1);
    }

    .tweet-stats_replies {
      color: rgb(92,184,92);
      background-color: rgba(92,184,92,.1);
    }

    .tweet-stats_total {
      padding: initial;
      font-size: 16px;
      border-bottom: none;
    }

    .tweet-stats__counter {
      display: inline-block;
    }

    .tweet-stats_total .tweet-stats__counter {
      padding: initial;
      color: rgb(0,0,0);
      font-size: 1em;
    }

    .tweet-graph__bar_own {
      color: rgb(51,122,183);
      background-color: rgba(51,122,183,.1);
      border-right: 1px solid rgba(51,122,183,.5);
    }

    .tweet-graph__bar_retweets {
      color: rgb(91,192,222);
      background-color: rgba(91,192,222,.1);
      border-right: 1px solid rgba(91,192,222,.5);
    }

    .tweet-graph__bar_replies {
      color: rgb(92,184,92);
      background-color: rgba(92,184,92,.1);
    }

    .best {
      position: relative;
    }

    .best::after {
      position: absolute;
      bottom: 100%;
      left: 100%;
      margin-bottom: -.85em;
      margin-right: -.5em;
      font-size: .75em;
      content: '★';
    }

    .best_middle::after {
      bottom: 50%;
      margin-bottom: -.85em;
    }

  .container
    .row
      .col-md-12
        table.host-stats
          thead.host-stats__head
            tr.host-stats__row.host-stats__row_head
              td.host-stats__col
              td.host-stats__col
              td.host-stats__col.host-stats__col_right Читатели
              td.host-stats__col.host-stats__col_right Твиты
              td.host-stats__col.host-stats__col_center
                .tweet-stats.tweet-stats_own
                  span.tweet-stats__label написал
                .tweet-stats.tweet-stats_retweets
                  span.tweet-stats__label ретвитнул
                .tweet-stats.tweet-stats_replies
                  span.tweet-stats__label ответил
              td.host-stats__col Ретвиты
              td.host-stats__col Избранное
          each author, index in stats
            tr.host-stats__row
              td.host-stats__col.host-stats__col_right= author.index
              td.host-stats__col
                a(href='/' + author.username) @#{author.username}
              if author.gainedFollowers > 0
                td.host-stats__col.host-stats__col_right.text-success
                  span(
                    class={best: author.maxGainedFollowers}
                  )= '+' + Math.abs(author.gainedFollowers)
              else if author.gainedFollowers < 0
                td.host-stats__col.host-stats__col_right.text-danger
                  = '−' + Math.abs(author.gainedFollowers)
              else
                td.host-stats__col.host-stats__col_right.text-muted
                  = Math.abs(author.gainedFollowers)

              td.host-stats__col.host-stats__col_right
                span(
                  class={best: author.maxTweets}
                )= author.tweets

              td.host-stats__col
                .tweet-graph(style='width: 100%;')
                  .tweet-graph__bar.tweet-graph__bar_own(
                    style='width: #{author.ownTweetsPercentage}%;'
                  )
                    span(
                      class={
                        best: author.maxOwnTweets,
                        best_middle: author.maxOwnTweets
                      }
                    )= author.ownTweets
                  .tweet-graph__bar.tweet-graph__bar_retweets(
                    style='width: #{author.retweetsPercentage}%;'
                  )
                    span(
                      class={
                        best: author.maxRetweets,
                        best_middle: author.maxRetweets
                      }
                    )= author.retweets
                  .tweet-graph__bar.tweet-graph__bar_replies(
                    style='width: #{author.repliesPercentage}%;'
                  )
                    span(
                      class={
                        best: author.maxReplies,
                        best_middle: author.maxReplies
                      }
                    )= author.replies
              td.host-stats__col.host-stats__col_kpi 0.83 / 15
              td.host-stats__col.host-stats__col_kpi 1.11 / 20

  .container
    .row
      .col-md-12
        .table-responsive
          table.table.table-hover.js-table-stat
            thead
              tr
                th: nobr Автор
                  small.sort-icon.sort-up= " ↑"
                  small.sort-icon.sort-down= " ↓"
                th.text-right: nobr
                  small.sort-icon.sort-up= "↑ "
                  small.sort-icon.sort-down= "↓ "
                  i.glyphicon.glyphicon-user
                  span.visible-lg-inline.visible-md-inline
                    |  Привёл
                    br
                    | подписчиков
                th.text-right
                  nobr
                    small.sort-icon.sort-up= "↑ "
                    small.sort-icon.sort-down= "↓ "
                    i.glyphicon.glyphicon-comment
                th.no-sort
                  span Твиты
                th
                  nobr
                    i.glyphicon.glyphicon-retweet
                    span.visible-lg-inline.visible-md-inline  Ретвитнут
                    small.sort-icon.sort-up= " ↑"
                    small.sort-icon.sort-down= " ↓"
                th
                  nobr
                    i.glyphicon.glyphicon-star
                    span.visible-lg-inline.visible-md-inline
                      |  Добавлен
                      br
                      | в избранное
                    small.sort-icon.sort-up= " ↑"
                    small.sort-icon.sort-down= " ↓"
            tbody
              each author, index in stats
                - var indexClass = index===0 ? 'progress-bar-striped active' : '';
                tr
                  td(data-sort="#{author.index}")
                    nobr
                      span.hidden-xs.hidden-sm(style="display: inline-block; width: 2em").text-right= author.index + "  "
                      if (index === 0)
                        a(href='https://twitter.com/jsunderhood') @#{author.username}…
                      else
                        a(href='/' + author.username) @#{author.username}
                  td.text-right(data-sort="#{author.gainedFollowers}")
                    nobr
                      if author.gainedFollowers > 0
                        | +
                      = author.gainedFollowers
                      if author.maxGainedFollowers
                        small.text-danger= " ★"
                  td(data-sort="#{author.tweets}").text-right
                    nobr
                      = author.tweets
                      if author.maxTweets
                        small.text-danger= " ★"
                  td(style="width: 100%")
                    .progress(style="margin-bottom: 0; min-width: 150px; width: 100%")
                      .progress-bar.progress-bar-primary(class=indexClass style="width: #{author.ownTweetsPercentage}%")
                        if author.maxOwnTweetsPercentage
                          small= "★ "
                        span.hidden-xs.hidden-sm Свои
                      .progress-bar.progress-bar-info(class=indexClass style="width: #{author.retweetsPercentage}%")
                        if author.maxRetweetsPercentage
                          small= "★ "
                        span.hidden-xs.hidden-sm RT
                      .progress-bar.progress-bar-success(class=indexClass style="width: #{author.repliesPercentage}%")
                        if author.maxRepliesPercentage
                          small= "★ "
                        span.hidden-xs.hidden-sm Ответы
                    nobr.hidden-xs.hidden-sm
                      span.text-primary
                        if author.maxOwnTweets
                          small.text-danger= "★ "
                        = ownTweetsUnit(author.ownTweets)
                      = ", "
                      span.text-info
                        if author.maxRetweets
                          small.text-danger= "★ "
                        = retweetsUnit(author.retweets)
                      = ", "
                      span.text-success
                        if author.maxReplies
                          small.text-danger= "★ "
                        = repliesUnit(author.replies)
                  td(data-sort="#{author.retweetedKpi}")
                    .progress(style="margin-bottom: 0; min-width: 50px")
                      .progress-bar(class=indexClass style="text-align: left !important; width: #{author.retweetedKpi*100}%")
                        if author.maxRetweetedKpi
                          small= "  ★"
                    nobr.hidden-xs.hidden-sm
                      = author.retweetedKpi
                      small.text-muted  / #{author.retweeted}
                  td(data-sort="#{author.favoritedKpi}")
                    .progress(style="margin-bottom: 0; min-width: 50px")
                      .progress-bar(class=indexClass style="text-align: left !important; width: #{author.favoritedKpi*100}%")
                        if author.maxFavoritedKpi
                          small= "  ★"
                    nobr.hidden-xs.hidden-sm
                      = author.favoritedKpi
                      small.text-muted  / #{author.favorited}
  script(src="https://cdn.rawgit.com/tristen/tablesort/gh-pages/src/tablesort.js")
  script(src="https://cdn.rawgit.com/tristen/tablesort/gh-pages/src/sorts/tablesort.numeric.js")
  script
    | new Tablesort(document.querySelector('.js-table-stat'), { descending: true });
